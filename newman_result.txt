newman

userapi tests order pay

→ create user 1
  POST http://arch.homework/otusapp/nryzhkov/api/v1/user  
  503 Service Temporarily Unavailable ★ 22ms time ★ 425B↑ 345B↓ size ★ 9↑ 4↓ headers ★ 0 cookies
  ┌ ↑ raw ★ 118B
  │ {"login":"n19398Eo9zV","email":"19398jC2Au@mail.ru","p
  │ assword":"12345678","first_name":"Nikita","last_name":
  │ "Ryzhkov"}
  └ 
  ┌ ↓ text/html ★ text ★ html ★ utf8 ★ 190B
  │ <html>
  │ <head><title>503 Service Temporarily Unavailable</titl
  │ e></head>
  │ <body>
  │ <center><h1>503 Service Temporarily Unavailable</h1></
  │ center>
  │ <hr><center>nginx</center>
  │ </body>
  │ </html>
  └
  prepare   wait   dns-lookup   tcp-handshake   transfer-start   download   process   total 
  10ms      6ms    3ms          494µs           5ms              5ms        114µs     32ms  

  1. Response status code is 201
  2. Response body contains user ID
  3. Empty wallet
  4⠄ JSONError in test-script

→ authorize user 1
  POST http://arch.homework/otusapp/nryzhkov/api/v1/login  
  500 Internal Server Error ★ 34ms time ★ 357B↑ 427B↓ size ★ 9↑ 4↓ headers ★ 0 cookies
  ┌ ↑ raw ★ 50B
  │ {
  │     "username": "",
  │     "password": "12345678"
  │ }
  └ 
  ┌ ↓ application/json ★ text ★ json ★ utf8 ★ 260B
  │ {"error":"failed to get user by login: failed to get u
  │ ser info: failed to get user info by http and login : 
  │ Get \"http://userapp-service.default.svc.cluster.local
  │ :8000/internal/api/v1/user/by_login/\": dial tcp 10.96
  │ .193.123:8000: connect: connection refused"}
  └
  prepare   wait    dns-lookup   tcp-handshake   transfer-start   download   process   total 
  882µs     251µs   (cache)      (cache)         32ms             1ms        36µs      34ms  

  5. Response status code is 200
  ✓  Response body contains user ID

→ billing money/credit
  POST http://arch.homework/otusapp/nryzhkov/api/v1/billing/money/credit  
  503 Service Temporarily Unavailable ★ 4ms time ★ 390B↑ 345B↓ size ★ 10↑ 4↓ headers ★ 0 cookies
  ┌ ↑ raw ★ 40B
  │ {
  │     "user_id": 0,
  │     "amount": 1000
  │ }
  └ 
  ┌ ↓ text/html ★ text ★ html ★ utf8 ★ 190B
  │ <html>
  │ <head><title>503 Service Temporarily Unavailable</titl
  │ e></head>
  │ <body>
  │ <center><h1>503 Service Temporarily Unavailable</h1></
  │ center>
  │ <hr><center>nginx</center>
  │ </body>
  │ </html>
  └
  prepare   wait    dns-lookup   tcp-handshake   transfer-start   download   process   total 
  604µs     121µs   (cache)      (cache)         2ms              642µs      20µs      3ms   

  6. Empty wallet

→ create order
  POST http://arch.homework/otusapp/nryzhkov/api/v1/order/create  
  503 Service Temporarily Unavailable ★ 2ms time ★ 385B↑ 345B↓ size ★ 10↑ 4↓ headers ★ 0 cookies
  ┌ ↑ raw ★ 43B
  │ {
  │     "item": "pencil1",
  │     "price": 150
  │ }
  └ 
  ┌ ↓ text/html ★ text ★ html ★ utf8 ★ 190B
  │ <html>
  │ <head><title>503 Service Temporarily Unavailable</titl
  │ e></head>
  │ <body>
  │ <center><h1>503 Service Temporarily Unavailable</h1></
  │ center>
  │ <hr><center>nginx</center>
  │ </body>
  │ </html>
  └
  prepare   wait    dns-lookup   tcp-handshake   transfer-start   download   process   total 
  573µs     118µs   (cache)      (cache)         1ms              587µs      20µs      2ms   

  7. Response status code is 201

→ get user 1
  GET http://arch.homework/otusapp/nryzhkov/api/v1/user/0  
  503 Service Temporarily Unavailable ★ 6ms time ★ 283B↑ 345B↓ size ★ 8↑ 4↓ headers ★ 0 cookies
  ┌ ↓ text/html ★ text ★ html ★ utf8 ★ 190B
  │ <html>
  │ <head><title>503 Service Temporarily Unavailable</titl
  │ e></head>
  │ <body>
  │ <center><h1>503 Service Temporarily Unavailable</h1></
  │ center>
  │ <hr><center>nginx</center>
  │ </body>
  │ </html>
  └
  prepare   wait    dns-lookup   tcp-handshake   transfer-start   download   process   total 
  2ms       417µs   (cache)      (cache)         3ms              1ms        86µs      8ms   

  8. Response status code is 200
  9. Money are withdrawn

→ notifications
  GET http://arch.homework/otusapp/nryzhkov/api/v1/notification/list  
  503 Service Temporarily Unavailable ★ 5ms time ★ 294B↑ 345B↓ size ★ 8↑ 4↓ headers ★ 0 cookies
  ┌ ↓ text/html ★ text ★ html ★ utf8 ★ 190B
  │ <html>
  │ <head><title>503 Service Temporarily Unavailable</titl
  │ e></head>
  │ <body>
  │ <center><h1>503 Service Temporarily Unavailable</h1></
  │ center>
  │ <hr><center>nginx</center>
  │ </body>
  │ </html>
  └
  prepare   wait    dns-lookup   tcp-handshake   transfer-start   download   process   total 
  1ms       273µs   (cache)      (cache)         2ms              1ms        45µs      5ms   

 10. Money are withdrawn

→ create expensive order
  POST http://arch.homework/otusapp/nryzhkov/api/v1/order/create  
  503 Service Temporarily Unavailable ★ 4ms time ★ 387B↑ 345B↓ size ★ 10↑ 4↓ headers ★ 0 cookies
  ┌ ↑ raw ★ 45B
  │ {
  │     "item": "pencil1",
  │     "price": 10000
  │ }
  └ 
  ┌ ↓ text/html ★ text ★ html ★ utf8 ★ 190B
  │ <html>
  │ <head><title>503 Service Temporarily Unavailable</titl
  │ e></head>
  │ <body>
  │ <center><h1>503 Service Temporarily Unavailable</h1></
  │ center>
  │ <hr><center>nginx</center>
  │ </body>
  │ </html>
  └
  prepare   wait    dns-lookup   tcp-handshake   transfer-start   download   process   total 
  858µs     193µs   (cache)      (cache)         1ms              864µs      30µs      3ms   

 11. Response status code is 201

→ get user 2
  GET http://arch.homework/otusapp/nryzhkov/api/v1/user/0  
  503 Service Temporarily Unavailable ★ 6ms time ★ 283B↑ 345B↓ size ★ 8↑ 4↓ headers ★ 0 cookies
  ┌ ↓ text/html ★ text ★ html ★ utf8 ★ 190B
  │ <html>
  │ <head><title>503 Service Temporarily Unavailable</titl
  │ e></head>
  │ <body>
  │ <center><h1>503 Service Temporarily Unavailable</h1></
  │ center>
  │ <hr><center>nginx</center>
  │ </body>
  │ </html>
  └
  prepare   wait    dns-lookup   tcp-handshake   transfer-start   download   process   total 
  1ms       500µs   (cache)      (cache)         3ms              1ms        52µs      7ms   

 12. Response status code is 200
 13. Money are withdrawn

→ notifications 2
  GET http://arch.homework/otusapp/nryzhkov/api/v1/notification/list  
  503 Service Temporarily Unavailable ★ 4ms time ★ 294B↑ 345B↓ size ★ 8↑ 4↓ headers ★ 0 cookies
  ┌ ↓ text/html ★ text ★ html ★ utf8 ★ 190B
  │ <html>
  │ <head><title>503 Service Temporarily Unavailable</titl
  │ e></head>
  │ <body>
  │ <center><h1>503 Service Temporarily Unavailable</h1></
  │ center>
  │ <hr><center>nginx</center>
  │ </body>
  │ </html>
  └
  prepare   wait    dns-lookup   tcp-handshake   transfer-start   download   process   total 
  1ms       318µs   (cache)      (cache)         2ms              1ms        38µs      5ms   

 14. Money are withdrawn

┌─────────────────────────┬──────────────────┬──────────────────┐
│                         │         executed │           failed │
├─────────────────────────┼──────────────────┼──────────────────┤
│              iterations │                1 │                0 │
├─────────────────────────┼──────────────────┼──────────────────┤
│                requests │                9 │                0 │
├─────────────────────────┼──────────────────┼──────────────────┤
│            test-scripts │               18 │                1 │
├─────────────────────────┼──────────────────┼──────────────────┤
│      prerequest-scripts │               11 │                0 │
├─────────────────────────┼──────────────────┼──────────────────┤
│              assertions │               14 │               13 │
├─────────────────────────┴──────────────────┴──────────────────┤
│ total run duration: 6.2s                                      │
├───────────────────────────────────────────────────────────────┤
│ total data received: 1.78kB (approx)                          │
├───────────────────────────────────────────────────────────────┤
│ average response time: 9ms [min: 2ms, max: 34ms, s.d.: 10ms]  │
├───────────────────────────────────────────────────────────────┤
│ average DNS lookup time: 3ms [min: 3ms, max: 3ms, s.d.: 0µs]  │
├───────────────────────────────────────────────────────────────┤
│ average first byte time: 6ms [min: 1ms, max: 32ms, s.d.: 9ms] │
└───────────────────────────────────────────────────────────────┘

[31m   # [39m[31m failure        [39m[31m detail                                                [39m
[90m     [39m[90m                [39m[90m                                                       [39m
 01.  AssertionError  Response status code is 201                           
                      expected response to have status code 201 but got 503 
                      at assertion:0 in test-script                         
                      inside "create user 1"                                
[90m     [39m[90m                [39m[90m                                                       [39m
 02.  JSONError       Response body contains user ID                        
                      Unexpected token '<' at 1:1                           
                      <html>                                                
                      ^                                                     
                      at assertion:1 in test-script                         
                      inside "create user 1"                                
[90m     [39m[90m                [39m[90m                                                       [39m
 03.  JSONError       Empty wallet                                          
                      Unexpected token '<' at 1:1                           
                      <html>                                                
                      ^                                                     
                      at assertion:2 in test-script                         
                      inside "create user 1"                                
[90m     [39m[90m                [39m[90m                                                       [39m
 04.  JSONError                                                             
                      Unexpected token '<' at 1:1                           
                      <html>                                                
                      ^                                                     
                      at test-script                                        
                      inside "create user 1"                                
[90m     [39m[90m                [39m[90m                                                       [39m
 05.  AssertionError  Response status code is 200                           
                      expected response to have status code 200 but got 500 
                      at assertion:0 in test-script                         
                      inside "authorize user 1"                             
[90m     [39m[90m                [39m[90m                                                       [39m
 06.  JSONError       Empty wallet                                          
                      Unexpected token '<' at 1:1                           
                      <html>                                                
                      ^                                                     
                      at assertion:0 in test-script                         
                      inside "billing money/credit"                         
[90m     [39m[90m                [39m[90m                                                       [39m
 07.  AssertionError  Response status code is 201                           
                      expected response to have status code 201 but got 503 
                      at assertion:0 in test-script                         
                      inside "create order"                                 
[90m     [39m[90m                [39m[90m                                                       [39m
 08.  AssertionError  Response status code is 200                           
                      expected 503 to equal 200                             
                      at assertion:0 in test-script                         
                      inside "get user 1"                                   
[90m     [39m[90m                [39m[90m                                                       [39m
 09.  JSONError       Money are withdrawn                                   
                      Unexpected token '<' at 1:1                           
                      <html>                                                
                      ^                                                     
                      at assertion:1 in test-script                         
                      inside "get user 1"                                   
[90m     [39m[90m                [39m[90m                                                       [39m
 10.  JSONError       Money are withdrawn                                   
                      Unexpected token '<' at 1:1                           
                      <html>                                                
                      ^                                                     
                      at assertion:0 in test-script                         
                      inside "notifications"                                
[90m     [39m[90m                [39m[90m                                                       [39m
 11.  AssertionError  Response status code is 201                           
                      expected response to have status code 201 but got 503 
                      at assertion:0 in test-script                         
                      inside "create expensive order"                       
[90m     [39m[90m                [39m[90m                                                       [39m
 12.  AssertionError  Response status code is 200                           
                      expected 503 to equal 200                             
                      at assertion:0 in test-script                         
                      inside "get user 2"                                   
[90m     [39m[90m                [39m[90m                                                       [39m
 13.  JSONError       Money are withdrawn                                   
                      Unexpected token '<' at 1:1                           
                      <html>                                                
                      ^                                                     
                      at assertion:1 in test-script                         
                      inside "get user 2"                                   
[90m     [39m[90m                [39m[90m                                                       [39m
 14.  JSONError       Money are withdrawn                                   
                      Unexpected token '<' at 1:1                           
                      <html>                                                
                      ^                                                     
                      at assertion:0 in test-script                         
                      inside "notifications 2"                              
